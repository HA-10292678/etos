<?xml version="1.0" encoding="UTF-8"?>

<model xmlns:sim="http://jf.cz/ns/simdsl/operators">
	<transaction id="starter">
		<start_transaction>
			<pause duration='480:00'/>
			<trace text='"simulation stopped"'/>
			<stop_simulation/>
		</start_transaction>
		<counted_loop count="$cars">
			<start_transaction sim:INSERT="#transaction[@id='e_car']"/>
		</counted_loop>
	</transaction>
	
	<transaction id="e_car" sim:DEFAULT_ATTRS="#entities" sim:actor="#actor">
		<pause_to period="24:00" time='normal:{mu: 8:00, sigma: 1:00}'/>
		<infinity_loop>
			<set property="a.batteryOutEvent" value="0.0"/>
			<route id="City" distance='context: "transaction", pnormal: {mu: 20, sigma: 5}'/>					
			<pause duration="8:30:00"/>
			<with probability="$shoppingProbability">						
				<transaction>
					<route id="City" distance='pnormal: {mu: 10, sigma: 5}'/>
					<fastCharging id="shop"
							duration="pnormal: {mu: 1:30,  sigma: 0:30}"
							queue_waiting="0:05"/>
					<checkpoint referedEntity="prev">
						<measure property="e.chargedEnergy" category="charged_f" type="stat"/>
					</checkpoint>
					<route id="City" distance='context: "transaction", pnormal: {mu: 18, sigma: 6}'/>		
				</transaction>
				<route id="City" distance='context: "transaction", pnormal: {mu: 20, sigma: 5}'/>				
			</with>
			<checkpoint>
					<measure property="a.batteryOutEvent" category="batteryOut" type="counter"/>
			</checkpoint>
			<homeCharging id="Home240" period="24:00" time='normal: {mu: 8:00, sigma: 1:00}'/>
			<checkpoint referedEntity="prev">
						<measure property="e.chargedEnergy" category="charged_h" type="stat"/>
			</checkpoint>
		</infinity_loop>
	</transaction>
	
	<entities>
		<route log="true"/>
        <fastCharging id="shop"
				voltage="400"
				current="36"
                resources="$stations"/>
        <homeCharging id="Home240"
				voltage="240"
				current="12"/>
	    <route id="City"
                limit="0.15"
				velocity='normal: {mu:40, sigma:5}'
				delay='normal: {mu: 1:00, sigma: 0:10}'/>
		<checkpoint id="log">
                <measure property="a.energy" category="energy" key="t.id" type="log"/>					
		</checkpoint>	    
 	</entities>
	<actor
		capacity="20"
		consumption="0.35"
		energy="20"
		batteryOutEvent="0"/>
</model>
